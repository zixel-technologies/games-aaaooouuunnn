<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Super Tic Tac Toe</title>
<style>
  :root {
    --bg: #000000;
    --panel-dark: #252525;
    --panel-mid: #404040;
    --color-x: #FF3535;
    --color-o: #FFA500;
  }
  body {
    margin: 0; padding: 0;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background: var(--bg);
    color: #e5e5e5;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    padding: 24px;
  }
  #app {
    max-width: 960px;
    width: 100%;
    display: flex;
    gap: 24px;
  }
  /* Left column with board and controls */
  #left-col {
    flex: 2;
    display: flex;
    flex-direction: column;
  }
  /* Right column with game info */
  #right-col {
    flex: 1;
    max-width: 320px;
  }
  h1 {
    font-size: 2rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }
  .description {
    color: #aaa;
    margin-bottom: 1rem;
  }
  .player-indicator {
    background: var(--panel-dark);
    padding: 8px 12px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 1rem;
    max-width: 200px;
  }
  .player-indicator div {
    font-size: 0.8rem;
  }
  button.reset-btn {
    background: var(--panel-mid);
    border: none;
    padding: 8px 14px;
    border-radius: 8px;
    color: #e5e5e5;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.2s;
  }
  button.reset-btn:hover {
    background: #575757;
  }
  .big-board {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    max-width: 720px;
    margin-bottom: 1rem;
  }
  .small-board {
    background: var(--panel-mid);
    border: 2px solid #444;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    aspect-ratio: 1 / 1;
    box-shadow: none;
    position: relative;
  }
  .small-board.active {
    box-shadow: 0 0 0 4px rgba(255,165,0,0.15);
  }
  .winner-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.6);
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.75rem;
    color: #e5e5e5;
    user-select: none;
    z-index: 2;
  }
  .winner-overlay.tie {
    background: rgba(0,0,0,0.45);
    font-size: 1rem;
    color: #ccc;
  }
  .cells {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 4px;
    padding: 8px;
    flex-grow: 1;
  }
  .cell {
    background: var(--panel-dark);
    border: 1px solid rgba(255,255,255,0.03);
    border-radius: 6px;
    aspect-ratio: 1 / 1;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: transform 0.1s ease;
    user-select: none;
  }
  .cell:active {
    transform: scale(0.95);
  }
  .cell.disabled {
    cursor: default;
    opacity: 0.4;
  }
  .symbol-x {
    stroke: var(--color-x);
    stroke-width: 3;
    stroke-linecap: round;
  }
  .symbol-o {
    stroke: var(--color-o);
    stroke-width: 3;
    fill: none;
  }
  .game-info {
    background: var(--panel-mid);
    padding: 16px;
    border-radius: 12px;
    color: #ccc;
  }
  .game-info h2 {
    margin-top: 0;
    margin-bottom: 0.5rem;
    font-weight: 600;
  }
  .small-winners {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
    margin-top: 8px;
  }
  .small-winners div {
    background: var(--panel-dark);
    padding: 4px 6px;
    border-radius: 6px;
    font-size: 0.8rem;
    text-align: center;
  }
  ol {
    padding-left: 18px;
    margin-top: 8px;
    margin-bottom: 0;
    font-size: 0.85rem;
    color: #bbb;
  }
  .history {
    margin-top: 12px;
    max-height: 160px;
    overflow-y: auto;
    font-size: 0.75rem;
    background: var(--panel-dark);
    border-radius: 10px;
    padding: 10px;
    color: #aaa;
  }
  .history div {
    margin-bottom: 4px;
  }
  footer {
    margin-top: 24px;
    font-size: 0.75rem;
    color: #555;
    text-align: center;
  }
</style>
</head>
<body>
  <div id="app">
    <div id="left-col">
      <h1>Super Tic Tac Toe</h1>
      <div class="description">Play on the 3×3 boards. Win small boards to win the game.</div>

      <div style="display:flex; align-items:center; justify-content:space-between; max-width: 500px; margin-bottom: 16px;">
        <div class="player-indicator">
          <div style="font-size:0.75rem; color:#aaa;">Current</div>
          <svg id="current-symbol" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" style="margin-left:4px;"></svg>
          <div id="current-text" style="margin-left:8px; font-weight:600;">❌ (Red)</div>
        </div>
        <button class="reset-btn" id="reset-btn">Reset</button>
      </div>

      <div class="big-board" id="big-board"></div>
    </div>

    <div id="right-col">
      <div class="game-info">
        <h2>Game Info</h2>
        <div><strong>Active board:</strong> <span id="active-board">Any</span></div>
        <div><strong>Overall winner:</strong> <span id="overall-winner">-</span></div>
        <div style="margin-top: 12px;">
          <strong>Small boards:</strong>
          <div class="small-winners" id="small-winners"></div>
        </div>
        <div style="margin-top: 12px;">
          <h3>How to play</h3>
          <ol>
            <li>Players alternate placing marks inside a small 3×3 board.</li>
            <li>Your move sends the opponent to the corresponding small board (by cell index).</li>
            <li>If that small board is finished, the opponent may play anywhere.</li>
            <li>Win three small boards in a row to win the game.</li>
          </ol>
        </div>
        <div style="margin-top:12px;">
          <h3>History</h3>
          <div class="history" id="history">No moves yet</div>
        </div>
      </div>
    </div>
  </div>

  <footer>Made with ❤️ • Colors and emoji-like symbols as requested.</footer>

<script>
(() => {
  // State
  let boards = Array(9).fill(null).map(() => Array(9).fill(null));
  let smallWinners = Array(9).fill(null);
  let current = "X";
  let activeBoard = null;
  let overallWinner = null;
  let history = [];

  // DOM references
  const bigBoardEl = document.getElementById("big-board");
  const activeBoardEl = document.getElementById("active-board");
  const overallWinnerEl = document.getElementById("overall-winner");
  const smallWinnersEl = document.getElementById("small-winners");
  const historyEl = document.getElementById("history");
  const currentSymbolEl = document.getElementById("current-symbol");
  const currentTextEl = document.getElementById("current-text");
  const resetBtn = document.getElementById("reset-btn");

  function createSVGSymbol(type, size=28) {
    if(type === "X"){
      const svgNS = "http://www.w3.org/2000/svg";
      const svg = document.createElementNS(svgNS, "svg");
      svg.setAttribute("width", size);
      svg.setAttribute("height", size);
      svg.setAttribute("viewBox", "0 0 24 24");
      svg.setAttribute("aria-hidden", "true");
      const path = document.createElementNS(svgNS, "path");
      path.setAttribute("d", "M4.5 4.5L19.5 19.5M19.5 4.5L4.5 19.5");
      path.setAttribute("stroke", "var(--color-x)");
      path.setAttribute("stroke-width", "2.5");
      path.setAttribute("stroke-linecap", "round");
      path.setAttribute("stroke-linejoin", "round");
      svg.appendChild(path);
      return svg;
    } else if(type === "O") {
      const svgNS = "http://www.w3.org/2000/svg";
      const svg = document.createElementNS(svgNS, "svg");
      svg.setAttribute("width", size);
      svg.setAttribute("height", size);
      svg.setAttribute("viewBox", "0 0 24 24");
      svg.setAttribute("aria-hidden", "true");
      const circle = document.createElementNS(svgNS, "circle");
      circle.setAttribute("cx", "12");
      circle.setAttribute("cy", "12");
      circle.setAttribute("r", "8");
      circle.setAttribute("stroke", "var(--color-o)");
      circle.setAttribute("stroke-width", "2.5");
      circle.setAttribute("fill", "none");
      svg.appendChild(circle);
      return svg;
    }
    return null;
  }

  // Winner logic
  function winnerOf(cells) {
    const lines = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6],
    ];
    for(const [a,b,c] of lines){
      if(cells[a] && cells[a] === cells[b] && cells[a] === cells[c]){
        return cells[a];
      }
    }
    if(cells.every(Boolean)) return "T"; // Tie
    return null;
  }

  function computeOverallWinner(){
    const board = smallWinners.map(w => w === "T" ? null : w);
    const w = winnerOf(board);
    if(w){
      overallWinner = w;
    } else if(smallWinners.every(s => s !== null)){
      overallWinner = "T";
    } else {
      overallWinner = null;
    }
  }

  // Render the entire big board with small boards and cells
  function renderBoardGrid(){
    bigBoardEl.innerHTML = "";
    for(let b=0; b<9; b++){
      const smallBoardDiv = document.createElement("div");
      smallBoardDiv.className = "small-board";
      if((activeBoard === null && !smallWinners[b]) || activeBoard === b){
        smallBoardDiv.classList.add("active");
      }
      if(smallWinners[b]){
        const overlay = document.createElement("div");
        overlay.className = "winner-overlay";
        if(smallWinners[b] === "T"){
          overlay.textContent = "TIE";
          overlay.classList.add("tie");
        } else {
          overlay.appendChild(createSVGSymbol(smallWinners[b], 36));
        }
        smallBoardDiv.appendChild(overlay);
      }

      const cellsDiv = document.createElement("div");
      cellsDiv.className = "cells";
      for(let c=0; c<9; c++){
        const cellBtn = document.createElement("button");
        cellBtn.className = "cell";
        if(boards[b][c]){
          cellBtn.appendChild(createSVGSymbol(boards[b][c], 28));
          cellBtn.disabled = true;
          cellBtn.classList.add("disabled");
        }
        // Disable if overall winner or not active board or board already won
        if(overallWinner || (activeBoard !== null && activeBoard !== b) || smallWinners[b]){
          cellBtn.disabled = true;
          cellBtn.classList.add("disabled");
        }
        cellBtn.addEventListener("click", () => handleCellClick(b, c));
        cellsDiv.appendChild(cellBtn);
      }
      smallBoardDiv.appendChild(cellsDiv);
      bigBoardEl.appendChild(smallBoardDiv);
    }
  }

  // Update info panel
  function updateInfo(){
    activeBoardEl.textContent = activeBoard === null ? "Any" : activeBoard;
    if(overallWinner === "T"){
      overallWinnerEl.textContent = "TIE";
    } else {
      overallWinnerEl.textContent = overallWinner ? overallWinner : "-";
    }
    smallWinnersEl.innerHTML = "";
    for(let i=0; i<9; i++){
      const div = document.createElement("div");
      div.textContent = i + ": " + (smallWinners[i] ? (smallWinners[i] === "T" ? "TIE" : smallWinners[i]) : "-");
      smallWinnersEl.appendChild(div);
    }
    historyEl.innerHTML = "";
    if(history.length === 0){
      historyEl.textContent = "No moves yet";
    } else {
      for(let i=history.length-1; i>=0; i--){
        const h = history[i];
        const div = document.createElement("div");
        div.textContent = `${h.player} → board ${h.bIdx} cell ${h.cIdx}`;
        historyEl.appendChild(div);
      }
    }
    // Current player symbol and text
    currentSymbolEl.innerHTML = "";
    currentSymbolEl.appendChild(createSVGSymbol(current, 20));
    currentTextEl.textContent = current === "X" ? "❌ (Red)" : "⭕ (Orange)";
  }

  // Handle clicks on cells
  function handleCellClick(bIdx, cIdx){
    if(overallWinner) return;
    if(activeBoard !== null && activeBoard !== bIdx) return;
    if(smallWinners[bIdx]) return;
    if(boards[bIdx][cIdx]) return;

    boards[bIdx][cIdx] = current;
    const w = winnerOf(boards[bIdx]);
    if(w) smallWinners[bIdx] = w;
    const nextActive = smallWinners[cIdx] ? null : cIdx;

    history.push({ bIdx, cIdx, player: current });
    current = current === "X" ? "O" : "X";
    activeBoard = nextActive;

    computeOverallWinner();
    renderBoardGrid();
    updateInfo();
  }

  // Reset everything
  function resetGame(){
    boards = Array(9).fill(null).map(() => Array(9).fill(null));
    smallWinners = Array(9).fill(null);
    current = "X";
    activeBoard = null;
    overallWinner = null;
    history = [];
    renderBoardGrid();
    updateInfo();
  }

  resetBtn.addEventListener("click", resetGame);

  // Initial render
  resetGame();
})();
</script>
</body>
</html>
